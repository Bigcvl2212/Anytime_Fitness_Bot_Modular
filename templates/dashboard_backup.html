{% extends "base.html" %}

{% block title %}Dashboard - Anytime Fitness{% endblock %}

{% block page_icon %}<i class="fas fa-tachometer-alt"></i>{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block header_actions %}
<div class="d-flex gap-2">
    <a href="#" class="outlook-btn outlook-btn-secondary">
        <i class="fas fa-sync-alt"></i>
        Refresh
    </a>
    <a href="/calendar" class="outlook-btn outlook-btn-primary">
        <i class="fas fa-calendar-plus"></i>
        New Event
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Statistics Overview -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="outlook-stat-card">
            <div class="outlook-stat-number">{{ training_sessions_count }}</div>
            <div class="outlook-stat-label">Training Sessions</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="outlook-stat-card">
            <div class="outlook-stat-number">{{ appointments_count }}</div>
            <div class="outlook-stat-label">Appointments</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="outlook-stat-card">
            <div class="outlook-stat-number">{{ bot_messages_today }}</div>
            <div class="outlook-stat-label">Bot Messages Sent</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="outlook-stat-card">
            <div class="outlook-stat-number">{{ active_conversations }}</div>
            <div class="outlook-stat-label">Active Conversations</div>
        </div>
    </div>
</div>

<!-- Today's Sessions & Appointments -->
<div class="outlook-card mb-4">
    <div class="outlook-card-header">
        <h5><i class="fas fa-calendar-day"></i> Today's Schedule</h5>
    </div>
    <div class="outlook-card-body p-0">
        {% if recent_events %}
            <!-- Schedule Header -->
            <div class="d-flex border-bottom" style="background: var(--af-gray-50); padding: 12px 20px;">
                <div style="width: 80px;" class="fw-bold text-muted small">TIME</div>
                <div style="width: 100px;" class="fw-bold text-muted small">TYPE</div>
                <div style="flex: 1;" class="fw-bold text-muted small">CLIENT / DETAILS</div>
                <div style="width: 120px;" class="fw-bold text-muted small">FUNDING</div>
                <div style="width: 100px;" class="fw-bold text-muted small">TRAINER</div>
                <div style="width: 80px;" class="fw-bold text-muted small">ACTIONS</div>
            </div>
            
            <!-- Schedule Items -->
            {% for event in recent_events %}
            <div class="d-flex align-items-center border-bottom session-row" style="padding: 16px 20px; transition: all 0.2s ease; cursor: pointer;" 
                 onclick="openEventDetails(this)"
                 data-participant="{{ event.get('participants', [''])[0] if event.get('participants') else 'Unknown' }}"
                 data-time="{{ event.get('start_time', '') }} - {{ event.get('end_time', '') }}"
                 data-trainer="{{ event.get('trainer', 'Not specified') }}"
                 data-type="{{ event.get('title', 'Training Session') }}"
                 data-location="{{ event.get('location', 'Training Floor') }}">
                <!-- Time -->
                <div style="width: 80px;">
                    <div class="fw-bold" style="color: var(--af-purple-primary);">
                        {{ event.get('start_time', 'TBD') }}
                    </div>
                    <small class="text-muted">
                        30min
                    </small>
                </div>
                
                <!-- Type Badge -->
                <div style="width: 100px;">
                    {% set is_appointment = (
                        'savannah' in (event.get('title', '') + ' ' + (event.get('participants', [''])[0] if event.get('participants') else '')).lower() or
                        not event.get('participants') or 
                        event.get('participants', [''])[0] == '' or
                        'consult' in event.get('title', '').lower() or
                        'appointment' in event.get('title', '').lower() or
                        'tour' in event.get('title', '').lower() or
                        'assessment' in event.get('title', '').lower() or
                        'meeting' in event.get('title', '').lower()
                    ) %}
                    {% if is_appointment %}
                        <span class="outlook-badge outlook-badge-warning">
                            <i class="fas fa-handshake"></i>
                            Appointment
                        </span>
                    {% else %}
                        <span class="outlook-badge outlook-badge-purple">
                            <i class="fas fa-dumbbell"></i>
                            Training
                        </span>
                    {% endif %}
                </div>
                
                <!-- Client/Details -->
                <div style="flex: 1;">
                    {% if event.get('participants') and event.get('participants')[0] and event.get('participants')[0].strip() %}
                        <div class="fw-bold" style="font-size: 16px;">{{ event.get('participants')[0] }}</div>
                        {% if event.get('participants')|length > 1 %}
                            <small class="text-muted">+ {{ event.get('participants')|length - 1 }} others: 
                                {% for participant in event.get('participants')[1:3] %}
                                    {{ participant }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                                {% if event.get('participants')|length > 3 %}...{% endif %}
                            </small>
                        {% endif %}
                        {% if event.get('title') and event.get('title') != event.get('participants')[0] %}
                            <div class="small text-muted">{{ event.get('title') }}</div>
                        {% endif %}
                    {% else %}
                        <div class="fw-bold" style="font-size: 16px;">{{ event.get('title', 'Unnamed Session') }}</div>
                        <small class="text-muted">No client assigned</small>
                    {% endif %}
                    {% if event.get('location') %}
                        <div class="small text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i>{{ event.get('location') }}
                        </div>
                    {% endif %}
                </div>
                
                <!-- Funding Status -->
                <div style="width: 120px;">
                    {% set client_name = event.get('participants', [''])[0] if event.get('participants') else '' %}
                    {% if client_name and client_name.strip() and not is_appointment %}
                        <!-- This will be populated with real funding data -->
                        <span class="outlook-badge outlook-badge-success" id="funding-{{ loop.index }}">
                            <i class="fas fa-credit-card"></i>
                            Checking...
                        </span>
                    {% elif is_appointment %}
                        <span class="outlook-badge outlook-badge-secondary">
                            <i class="fas fa-info"></i>
                            N/A
                        </span>
                    {% else %}
                        <span class="outlook-badge outlook-badge-danger">
                            <i class="fas fa-exclamation"></i>
                            No Client
                        </span>
                    {% endif %}
                </div>
                
                <!-- Trainer -->
                <div style="width: 100px;">
                    {% if event.get('trainer') %}
                        <div class="fw-bold">{{ event.get('trainer') }}</div>
                    {% else %}
                        <span class="text-muted">Jeremy</span>
                    {% endif %}
                </div>
                
                <!-- Actions -->
                <div style="width: 80px;" onclick="event.stopPropagation();">
                    <div class="d-flex gap-1">
                        <button class="btn btn-sm outlook-btn outlook-btn-secondary p-1" title="Edit" style="width: 32px; height: 32px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <form method="POST" action="/calendar/delete/{{ event.get('id', '') }}" style="display: inline;">
                            <button type="submit" class="btn btn-sm outlook-btn outlook-btn-danger p-1" title="Delete" style="width: 32px; height: 32px;"
                                    onclick="return confirm('Delete this session?')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <!-- Quick Add Section -->
            <div class="p-3 text-center" style="background: var(--af-gray-50); border-top: 1px solid var(--af-gray-200);">
                <a href="/calendar" class="outlook-btn outlook-btn-primary">
                    <i class="fas fa-plus"></i>
                    Add New Session
                </a>
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
                <h6 class="text-muted">No sessions scheduled for today</h6>
                <p class="text-muted small mb-3">Your schedule is clear! Perfect time to reach out to prospects.</p>
                <a href="/calendar" class="outlook-btn outlook-btn-primary">
                    <i class="fas fa-plus"></i>
                    Schedule Session
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions and Bot Supervision -->
<div class="row mb-4">
    <div class="col-lg-6 mb-3">
        <div class="outlook-card">
            <div class="outlook-card-header">
                <h5><i class="fas fa-robot"></i> Bot Activity Monitor</h5>
            </div>
            <div class="outlook-card-body">
                <div class="mb-3">
                    <strong class="text-muted">Recent Bot Actions</strong>
                </div>
                
                <!-- Bot Activity Log -->
                <div id="bot-activity-log" style="max-height: 300px; overflow-y: auto;">
                    {% if bot_activities %}
                        {% for activity in bot_activities[:10] %}
                        <div class="d-flex justify-content-between align-items-start mb-3 p-2 rounded" style="background: var(--af-gray-100);">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <i class="fas fa-{{ activity.icon }} text-{{ activity.color }} me-2"></i>
                                    <span class="fw-bold">{{ activity.action }}</span>
                                </div>
                                <div class="text-muted small">
                                    To: {{ activity.recipient }}
                                </div>
                                {% if activity.preview %}
                                <div class="text-muted small mt-1" style="font-style: italic;">
                                    "{{ activity.preview[:50] }}..."
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-end">
                                <small class="text-muted">{{ activity.time }}</small>
                                <div>
                                    <span class="outlook-badge outlook-badge-{{ activity.status_color }}">
                                        {{ activity.status }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-3">
                            <i class="fas fa-robot fa-2x text-muted mb-2"></i>
                            <p class="text-muted mb-0">No bot activity yet today</p>
                            <small class="text-muted">Bot will start monitoring and messaging automatically</small>
                        </div>
                    {% endif %}
                </div>
                
                <div class="mt-3 d-flex gap-2">
                    <a href="/bot-settings" class="outlook-btn outlook-btn-secondary flex-fill">
                        <i class="fas fa-cog"></i>
                        Bot Settings
                    </a>
                    <a href="/bot-logs" class="outlook-btn outlook-btn-primary">
                        <i class="fas fa-list"></i>
                        Full Log
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6 mb-3">
        <div class="outlook-card">
            <div class="outlook-card-header">
                <h5><i class="fas fa-inbox"></i> Bot Inbox Supervision</h5>
            </div>
            <div class="outlook-card-body">
                <div class="mb-3">
                    <strong class="text-muted">Active Conversations</strong>
                </div>
                
                <!-- Quick Glance Inbox -->
                <div id="bot-inbox" style="max-height: 300px; overflow-y: auto;">
                    {% if bot_conversations %}
                        {% for conversation in bot_conversations[:8] %}
                        <div class="d-flex justify-content-between align-items-start mb-3 p-2 rounded border" 
                             style="background: white; cursor: pointer;" 
                             onclick="viewConversation('{{ conversation.id }}')">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <div class="rounded-circle me-2" 
                                         style="width: 8px; height: 8px; background: {% if conversation.unread %}var(--af-purple-primary){% else %}var(--af-gray-300){% endif %};"></div>
                                    <span class="fw-bold">{{ conversation.contact_name }}</span>
                                    {% if conversation.unread %}
                                        <span class="outlook-badge outlook-badge-purple ms-2">New</span>
                                    {% endif %}
                                </div>
                                <div class="text-muted small mb-1">
                                    <i class="fas fa-{{ 'robot' if conversation.last_sender == 'bot' else 'user' }} me-1"></i>
                                    {{ conversation.last_message[:40] }}...
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="outlook-badge outlook-badge-{{ conversation.status_color }}">
                                        {{ conversation.status }}
                                    </span>
                                    <small class="text-muted ms-2">{{ conversation.last_time }}</small>
                                </div>
                            </div>
                            <div class="text-end">
                                {% if conversation.needs_attention %}
                                    <i class="fas fa-exclamation-triangle text-warning"></i>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-3">
                            <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                            <p class="text-muted mb-0">No active conversations</p>
                            <small class="text-muted">Bot will start conversations automatically</small>
                        </div>
                    {% endif %}
                </div>
                
                <div class="mt-3 d-flex gap-2">
                    <a href="/inbox" class="outlook-btn outlook-btn-secondary flex-fill">
                        <i class="fas fa-envelope"></i>
                        Full Inbox
                    </a>
                    <button class="outlook-btn outlook-btn-primary" onclick="refreshInbox()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Status -->
<div class="outlook-card">
    <div class="outlook-card-header">
        <h5><i class="fas fa-cog"></i> System Status</h5>
    </div>
    <div class="outlook-card-body">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-database fa-2x {{ 'text-success' if clubos_connected else 'text-danger' }}"></i>
                    </div>
                    <div>
                        <div class="fw-bold">ClubOS Integration</div>
                        <span class="outlook-badge {{ 'outlook-badge-success' if clubos_connected else 'outlook-badge-danger' }}">
                            <i class="fas fa-{{ 'check-circle' if clubos_connected else 'times-circle' }}"></i>
                            {{ clubos_status }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-calendar-sync fa-2x text-success"></i>
                    </div>
                    <div>
                        <div class="fw-bold">Calendar Sync</div>
                        <span class="outlook-badge outlook-badge-success">
                            <i class="fas fa-sync-alt"></i>
                            {{ total_live_events }} Events
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-clock fa-2x text-warning"></i>
                    </div>
                    <div>
                        <div class="fw-bold">Last Sync</div>
                        <span class="outlook-badge outlook-badge-warning">
                            <i class="fas fa-clock"></i>
                            Just now
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-3 text-center">
            <form method="POST" action="/calendar/sync" style="display: inline;">
                <button type="submit" class="outlook-btn outlook-btn-primary">
                    <i class="fas fa-sync-alt"></i>
                    Sync Calendar Now
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

<!-- Event Details Modal -->
<div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: var(--border-radius-large); border: none;">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--af-purple-primary) 0%, var(--af-purple-dark) 100%); color: white; border-radius: var(--border-radius-large) var(--border-radius-large) 0 0;">
                <h5 class="modal-title" id="eventDetailsModalLabel">
                    <i class="fas fa-calendar-alt me-2"></i>Session Details
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">CLIENT</label>
                            <div class="fs-5 fw-bold" id="modal-participant">-</div>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">TIME</label>
                            <div class="fs-6" id="modal-time">-</div>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">TRAINER</label>
                            <div class="fs-6" id="modal-trainer">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">SESSION TYPE</label>
                            <div id="modal-type">-</div>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">LOCATION</label>
                            <div class="fs-6" id="modal-location">Training Floor</div>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold text-muted small">FUNDING STATUS</label>
                            <div id="modal-funding">
                                <span class="outlook-badge outlook-badge-warning">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Checking...
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Training Package Details -->
                <div id="training-package-details" style="display: none;">
                    <hr class="my-4">
                    <h6 class="fw-bold mb-3">
                        <i class="fas fa-file-contract me-2"></i>Training Package Details
                    </h6>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="fw-bold text-muted small">SESSIONS REMAINING</label>
                                <div class="fs-4 fw-bold text-success" id="sessions-remaining">-</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="fw-bold text-muted small">PACKAGE TYPE</label>
                                <div id="package-type">-</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="fw-bold text-muted small">EXPIRATION</label>
                                <div id="package-expiration">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold text-muted small">PURCHASE DATE</label>
                                <div id="purchase-date">-</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="fw-bold text-muted small">TOTAL PAID</label>
                                <div class="fw-bold text-success" id="total-paid">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="outlook-btn outlook-btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button type="button" class="outlook-btn outlook-btn-primary" id="edit-session-btn">
                    <i class="fas fa-edit"></i>
                    Edit Session
                </button>
                <button type="button" class="outlook-btn outlook-btn-danger" id="delete-session-btn">
                    <i class="fas fa-trash"></i>
                    Delete Session
                </button>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
// Event details popup functions
function openEventDetails(element) {
    // Get data from the clicked row
    const participant = element.getAttribute('data-participant') || 'Unknown';
    const time = element.getAttribute('data-time') || '';
    const trainer = element.getAttribute('data-trainer') || 'Not specified';
    const eventType = element.getAttribute('data-type') || 'Training Session';
    const location = element.getAttribute('data-location') || 'Training Floor';
    
    // Update modal content
    document.getElementById('modal-participant').textContent = participant;
    document.getElementById('modal-time').textContent = time;
    document.getElementById('modal-trainer').textContent = trainer;
    document.getElementById('modal-type').textContent = eventType;
    document.getElementById('modal-location').textContent = location;
    
    // Reset funding status to checking
    document.getElementById('modal-funding').innerHTML = `
        <span class="outlook-badge outlook-badge-warning">
            <i class="fas fa-spinner fa-spin"></i>
            Checking...
        </span>
    `;
    
    // Hide training package details initially
    document.getElementById('training-package-details').style.display = 'none';
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
    modal.show();
    
    // Simulate funding verification (replace with actual API call)
    setTimeout(() => {
        checkFundingStatus(participant, time);
    }, 1500);
}

function checkFundingStatus(participant, time) {
    // This would normally make an API call to check training agreements
    // For now, we'll simulate different funding statuses based on participant name
    
    let fundingStatus = '';
    let fundingClass = '';
    let showPackageDetails = false;
    
    if (participant.toLowerCase().includes('savannah')) {
        fundingStatus = '<i class="fas fa-check-circle"></i> Funded - Active Package';
        fundingClass = 'outlook-badge-success';
        showPackageDetails = true;
        
        // Mock package details for Savannah
        document.getElementById('sessions-remaining').textContent = '8';
        document.getElementById('package-type').textContent = '12-Session Package';
        document.getElementById('package-expiration').textContent = 'March 15, 2024';
        document.getElementById('purchase-date').textContent = 'January 15, 2024';
        document.getElementById('total-paid').textContent = '$1,200.00';
        
    } else if (participant.toLowerCase().includes('unknown') || participant === 'Unknown') {
        fundingStatus = '<i class="fas fa-exclamation-triangle"></i> Unknown Client';
        fundingClass = 'outlook-badge-danger';
    } else {
        // Random status for other clients
        const statuses = [
            { text: '<i class="fas fa-check-circle"></i> Funded - Active Package', class: 'outlook-badge-success', hasPackage: true },
            { text: '<i class="fas fa-clock"></i> Payment Pending', class: 'outlook-badge-warning', hasPackage: false },
            { text: '<i class="fas fa-times-circle"></i> No Active Package', class: 'outlook-badge-danger', hasPackage: false },
            { text: '<i class="fas fa-credit-card"></i> Trial Session', class: 'outlook-badge-info', hasPackage: false }
        ];
        
        const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
        fundingStatus = randomStatus.text;
        fundingClass = randomStatus.class;
        showPackageDetails = randomStatus.hasPackage;
        
        if (showPackageDetails) {
            // Mock package details for funded clients
            document.getElementById('sessions-remaining').textContent = Math.floor(Math.random() * 15) + 1;
            document.getElementById('package-type').textContent = ['8-Session Package', '12-Session Package', '20-Session Package'][Math.floor(Math.random() * 3)];
            document.getElementById('package-expiration').textContent = 'March ' + (Math.floor(Math.random() * 28) + 1) + ', 2024';
            document.getElementById('purchase-date').textContent = 'January ' + (Math.floor(Math.random() * 28) + 1) + ', 2024';
            document.getElementById('total-paid').textContent = '$' + ((Math.floor(Math.random() * 20) + 8) * 100) + '.00';
        }
    }
    
    // Update funding status
    document.getElementById('modal-funding').innerHTML = `
        <span class="outlook-badge ${fundingClass}">
            ${fundingStatus}
        </span>
    `;
    
    // Show/hide package details
    if (showPackageDetails) {
        document.getElementById('training-package-details').style.display = 'block';
    }
}

// Auto-refresh dashboard every 5 minutes
setTimeout(function() {
    location.reload();
}, 300000);

// Bot supervision functions
function viewConversation(conversationId) {
    window.open(`/conversation/${conversationId}`, '_blank');
}

function refreshInbox() {
    fetch('/api/refresh-inbox', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => {
        console.error('Error refreshing inbox:', error);
    });
}

// Real-time bot activity updates
function updateBotActivity() {
    fetch('/api/bot-activity')
    .then(response => response.json())
    .then(data => {
        const activityLog = document.getElementById('bot-activity-log');
        if (data.activities && data.activities.length > 0) {
            // Update activity log without full page refresh
            updateActivityDisplay(data.activities);
        }
    })
    .catch(error => {
        console.error('Error fetching bot activity:', error);
    });
}

function updateActivityDisplay(activities) {
    const activityLog = document.getElementById('bot-activity-log');
    let html = '';
    
    activities.slice(0, 10).forEach(activity => {
        html += `
            <div class="d-flex justify-content-between align-items-start mb-3 p-2 rounded" style="background: var(--af-gray-100);">
                <div class="flex-grow-1">
                    <div class="d-flex align-items-center mb-1">
                        <i class="fas fa-${activity.icon} text-${activity.color} me-2"></i>
                        <span class="fw-bold">${activity.action}</span>
                    </div>
                    <div class="text-muted small">
                        To: ${activity.recipient}
                    </div>
                    ${activity.preview ? `<div class="text-muted small mt-1" style="font-style: italic;">"${activity.preview.substring(0, 50)}..."</div>` : ''}
                </div>
                <div class="text-end">
                    <small class="text-muted">${activity.time}</small>
                    <div>
                        <span class="outlook-badge outlook-badge-${activity.status_color}">
                            ${activity.status}
                        </span>
                    </div>
                </div>
            </div>
        `;
    });
    
    if (html) {
        activityLog.innerHTML = html;
    }
}

// Poll for bot activity updates every 30 seconds
setInterval(updateBotActivity, 30000);

// Add smooth animations
document.addEventListener('DOMContentLoaded', function() {
    // Animate stat cards on load
    const statCards = document.querySelectorAll('.outlook-stat-card');
    statCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Add hover effects to training session cards
    document.querySelectorAll('.training-session-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
            this.style.boxShadow = 'var(--shadow-16)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = 'var(--shadow-2)';
        });
    });
    
    // Add hover effects to session rows
    document.querySelectorAll('.session-row').forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.background = 'var(--af-gray-50)';
            this.style.borderLeft = '4px solid var(--af-purple-primary)';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.background = 'white';
            this.style.borderLeft = 'none';
        });
    });
    
    // Add hover effects to conversation items
    document.querySelectorAll('#bot-inbox .border').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.background = 'var(--af-gray-100)';
            this.style.borderColor = 'var(--af-purple-primary)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.background = 'white';
            this.style.borderColor = 'var(--af-gray-200)';
        });
    });
    
    // Add click handlers for modal action buttons
    const editSessionBtn = document.getElementById('edit-session-btn');
    const deleteSessionBtn = document.getElementById('delete-session-btn');
    
    if (editSessionBtn) {
        editSessionBtn.addEventListener('click', function() {
            alert('Edit session functionality would open here');
        });
    }
    
    if (deleteSessionBtn) {
        deleteSessionBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this session?')) {
                alert('Session deletion functionality would execute here');
            }
        });
    }
});
</script>
{% endblock %}