{% extends "base.html" %}
{% block title %}Personal Training - Anytime FitnessÂ®{% endblock %}
{% block page_title %}Personal Training Management{% endblock %}
{% block page_subtitle %}Maximize your personal training revenue and client satisfaction{% endblock %}
{% block content %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5><i class="fas fa-user-friends me-2"></i>Personal Training Clients ({{ total_training_clients }} total)</h5>
        <div class="d-flex gap-2">
            <!-- Search Form -->
            <form method="GET" class="d-flex gap-2">
                <input type="text" 
                       name="search" 
                       value="{{ search }}" 
                       placeholder="Search clients or trainers..." 
                       class="form-control form-control-sm" 
                       style="width: 200px;">
                
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fas fa-search"></i> Search
                </button>
                
                {% if search %}
                <a href="{{ url_for('training_clients_page') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-times"></i> Clear
                </a>
                {% endif %}
            </form>
        </div>
    </div>
    <div class="card-body">
        {% if training_clients %}
        <div class="table-container">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Trainer</th>
                        <th>Session Type</th>
                        <th>Sessions Left</th>
                        <th>Last Session</th>
                        <th>Funding Status</th>
                        <th>Agreement</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in training_clients %}
                    <tr>
                        <td>
                            <strong>{{ client.member_name or 'Unknown Member' }}</strong>
                            <br>
                            <small class="text-muted">ID: {{ client.client_id or client.id }}</small>
                            {% if client.clubos_member_id %}
                            <br>
                            <small class="text-muted">ClubOS: {{ client.clubos_member_id }}</small>
                            {% endif %}
                        </td>
                        <td>{{ client.trainer_name or 'Not Assigned' }}</td>
                        <td>
                            {% if client.session_type %}
                            <span class="badge badge-purple">{{ client.session_type }}</span>
                            {% else %}
                            <span class="badge bg-secondary">Not Specified</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if client.sessions_remaining is not none %}
                            <span class="badge {% if client.sessions_remaining > 5 %}bg-success{% elif client.sessions_remaining > 2 %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ client.sessions_remaining }}
                            </span>
                            {% else %}
                            <span class="badge bg-secondary">Unknown</span>
                            {% endif %}
                        </td>
                        <td>{{ client.last_session or 'Never' }}</td>
                        <td>
                            <span class="badge bg-{{ client.funding_status_class }}">
                                <i class="{{ client.funding_status_icon }} me-1"></i>
                                {{ client.funding_status }}
                            </span>
                        </td>
                        <td>
                            {% if client.agreement_name %}
                            <div>
                                <strong>{{ client.agreement_name }}</strong>
                                {% if client.agreement_expiration_date %}
                                <br>
                                <small class="text-muted">Expires: {{ client.agreement_expiration_date }}</small>
                                {% endif %}
                            </div>
                            {% else %}
                            <span class="text-muted">No Agreement</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm">
                    {% if page > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('training_clients_page', page=page-1, search=search) }}">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <li class="page-item active">
                        <span class="page-link">{{ p }}</span>
                    </li>
                    {% elif p <= 3 or p >= total_pages - 2 or (p >= page - 1 and p <= page + 1) %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('training_clients_page', page=p, search=search) }}">{{ p }}</a>
                    </li>
                    {% elif p == 4 and page > 6 %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                    {% elif p == total_pages - 3 and page < total_pages - 5 %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                    {% endif %}
                    {% endfor %}
                    
                    {% if page < total_pages %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('training_clients_page', page=page+1, search=search) }}">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        
        <div class="text-center text-secondary text-xs mt-2">
            Showing {{ ((page-1) * per_page + 1) }} to {{ (page * per_page if page * per_page < total_training_clients else total_training_clients) }} of {{ total_training_clients }} training clients
        </div>
        {% endif %}
        
        {% else %}
        <div class="text-center py-4">
            <i class="fas fa-user-friends fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No training clients found</h5>
            {% if search %}
            <p class="text-muted">Try adjusting your search criteria.</p>
            <a href="{{ url_for('training_clients_page') }}" class="btn btn-primary">Show All Clients</a>
            {% else %}
            <p class="text-muted">No personal training clients in the database.</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}