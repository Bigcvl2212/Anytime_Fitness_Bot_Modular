{% extends "base.html" %}

{% block title %}Admin Settings - Gym Bot{% endblock %}

{% block content %}
<div class="admin-settings-container">
    <div class="settings-header">
        <h1>üîß Admin System Settings</h1>
        <p class="subtitle">Configure administrative features, security, and system behavior</p>
    </div>

    <!-- Settings Navigation -->
    <div class="settings-layout">
        <aside class="settings-sidebar">
            <nav class="settings-nav">
                <div class="nav-section">
                    <h3>Security & Access</h3>
                    <a href="#security" class="nav-item active" data-section="security">
                        <span class="icon">üîí</span> Security
                    </a>
                    <a href="#permissions" class="nav-item" data-section="permissions">
                        <span class="icon">üë•</span> Permissions
                    </a>
                    <a href="#authentication" class="nav-item" data-section="authentication">
                        <span class="icon">üîë</span> Authentication
                    </a>
                </div>
                <div class="nav-section">
                    <h3>System Management</h3>
                    <a href="#maintenance" class="nav-item" data-section="maintenance">
                        <span class="icon">‚öôÔ∏è</span> Maintenance
                    </a>
                    <a href="#logging" class="nav-item" data-section="logging">
                        <span class="icon">üìù</span> Logging & Audit
                    </a>
                    <a href="#backups" class="nav-item" data-section="backups">
                        <span class="icon">üíæ</span> Backups
                    </a>
                </div>
                <div class="nav-section">
                    <h3>Integrations</h3>
                    <a href="#api" class="nav-item" data-section="api">
                        <span class="icon">üîå</span> API Configuration
                    </a>
                    <a href="#webhooks" class="nav-item" data-section="webhooks">
                        <span class="icon">ü™ù</span> Webhooks
                    </a>
                </div>
            </nav>
        </aside>

        <main class="settings-content">
            <!-- Security Settings -->
            <section id="security" class="settings-section active">
                <h2>üîí Security Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Session Timeout (minutes)</span>
                        <input type="number" id="session_timeout" class="form-control" value="30" min="5" max="1440">
                    </label>
                    <p class="setting-description">Auto-logout after inactivity (5-1440 minutes)</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Max Failed Login Attempts</span>
                        <input type="number" id="max_login_attempts" class="form-control" value="5" min="3" max="10">
                    </label>
                    <p class="setting-description">Lock account after this many failed attempts</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Account Lockout Duration (minutes)</span>
                        <input type="number" id="lockout_duration" class="form-control" value="15" min="5" max="120">
                    </label>
                    <p class="setting-description">How long to lock account after failed attempts</p>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="require_password_change" checked>
                        <span>Require password change every 90 days</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="enable_2fa">
                        <span>Enable Two-Factor Authentication (2FA)</span>
                    </label>
                    <p class="setting-description">Require 2FA for super admin accounts</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Allowed IP Addresses (comma-separated)</span>
                        <input type="text" id="allowed_ips" class="form-control" placeholder="Leave blank to allow all">
                    </label>
                    <p class="setting-description">Restrict admin access to specific IPs (optional)</p>
                </div>
            </section>

            <!-- Permissions Settings -->
            <section id="permissions" class="settings-section">
                <h2>üë• Permission Management</h2>
                
                <div class="setting-group">
                    <h3>Default Admin Permissions</h3>
                    <p class="setting-description">Permissions granted to new admin users</p>
                    <div class="permission-grid">
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="dashboard_view" checked>
                            <span>View Dashboard</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="user_management">
                            <span>User Management</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="system_settings">
                            <span>System Settings</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="data_management">
                            <span>Data Management</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="audit_logs">
                            <span>View Audit Logs</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" name="default_perms" value="api_access">
                            <span>API Access</span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="allow_permission_escalation">
                        <span>Allow admins to grant permissions they don't have</span>
                    </label>
                    <p class="setting-description">‚ö†Ô∏è Security risk - only enable if needed</p>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="require_approval_for_super_admin" checked>
                        <span>Require super admin approval for new admins</span>
                    </label>
                </div>
            </section>

            <!-- Authentication Settings -->
            <section id="authentication" class="settings-section">
                <h2>üîë Authentication Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Password Minimum Length</span>
                        <input type="number" id="password_min_length" class="form-control" value="8" min="6" max="32">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="password_require_uppercase" checked>
                        <span>Require uppercase letters</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="password_require_lowercase" checked>
                        <span>Require lowercase letters</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="password_require_numbers" checked>
                        <span>Require numbers</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="password_require_special">
                        <span>Require special characters (!@#$%^&*)</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Password History (prevent reuse)</span>
                        <input type="number" id="password_history" class="form-control" value="5" min="0" max="24">
                    </label>
                    <p class="setting-description">Number of old passwords to prevent reuse</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Authentication Method</span>
                        <select id="auth_method" class="form-control">
                            <option value="database" selected>Database (Default)</option>
                            <option value="ldap">LDAP / Active Directory</option>
                            <option value="oauth">OAuth 2.0</option>
                            <option value="saml">SAML 2.0</option>
                        </select>
                    </label>
                </div>
            </section>

            <!-- Maintenance Settings -->
            <section id="maintenance" class="settings-section">
                <h2>‚öôÔ∏è Maintenance Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="maintenance_mode">
                        <span>Enable Maintenance Mode</span>
                    </label>
                    <p class="setting-description">Display maintenance page to non-admin users</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Maintenance Message</span>
                        <textarea id="maintenance_message" class="form-control" rows="3">System is undergoing scheduled maintenance. Please check back soon.</textarea>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Auto-restart on Crash</span>
                        <select id="auto_restart" class="form-control">
                            <option value="enabled" selected>Enabled</option>
                            <option value="disabled">Disabled</option>
                            <option value="limited">Limited (3 attempts)</option>
                        </select>
                    </label>
                </div>

                <div class="setting-group">
                    <h3>Database Maintenance</h3>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="auto_vacuum" checked>
                        <span>Auto-vacuum database weekly</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="auto_optimize" checked>
                        <span>Auto-optimize indexes daily</span>
                    </label>
                </div>
            </section>

            <!-- Logging Settings -->
            <section id="logging" class="settings-section">
                <h2>üìù Logging & Audit Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Log Level</span>
                        <select id="log_level" class="form-control">
                            <option value="DEBUG">DEBUG (Verbose)</option>
                            <option value="INFO" selected>INFO (Normal)</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR (Critical Only)</option>
                        </select>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Log Retention (days)</span>
                        <input type="number" id="log_retention_days" class="form-control" value="90" min="7" max="730">
                    </label>
                    <p class="setting-description">Delete logs older than this many days</p>
                </div>

                <div class="setting-group">
                    <h3>Audit Log Settings</h3>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="audit_login_attempts" checked>
                        <span>Log all login attempts (success and failure)</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="audit_permission_changes" checked>
                        <span>Log permission changes</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="audit_data_access" checked>
                        <span>Log sensitive data access</span>
                    </label>
                    <label class="setting-checkbox">
                        <input type="checkbox" id="audit_api_calls">
                        <span>Log all API calls</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Audit Retention (days)</span>
                        <input type="number" id="audit_retention_days" class="form-control" value="365" min="30" max="3650">
                    </label>
                    <p class="setting-description">Keep audit logs for this many days (compliance requirement)</p>
                </div>
            </section>

            <!-- Backup Settings -->
            <section id="backups" class="settings-section">
                <h2>üíæ Backup Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="auto_backup_enabled" checked>
                        <span>Enable automatic backups</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Backup Frequency</span>
                        <select id="backup_frequency" class="form-control">
                            <option value="hourly">Every Hour</option>
                            <option value="every_6_hours">Every 6 Hours</option>
                            <option value="daily" selected>Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Backup Time (if daily/weekly)</span>
                        <input type="time" id="backup_time" class="form-control" value="02:00">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Backup Retention Count</span>
                        <input type="number" id="backup_retention_count" class="form-control" value="7" min="1" max="90">
                    </label>
                    <p class="setting-description">Keep this many recent backups</p>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Backup Location</span>
                        <input type="text" id="backup_location" class="form-control" value="./backups" placeholder="./backups">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="backup_compress" checked>
                        <span>Compress backups (save space)</span>
                    </label>
                </div>

                <div class="setting-group">
                    <button class="btn btn-secondary" onclick="triggerManualBackup()">
                        <span class="icon">üíæ</span> Trigger Manual Backup Now
                    </button>
                </div>
            </section>

            <!-- API Configuration -->
            <section id="api" class="settings-section">
                <h2>üîå API Configuration</h2>
                
                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="api_enabled" checked>
                        <span>Enable REST API</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">API Rate Limit (requests/minute)</span>
                        <input type="number" id="api_rate_limit" class="form-control" value="60" min="10" max="1000">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">API Key Expiration (days)</span>
                        <input type="number" id="api_key_expiration" class="form-control" value="90" min="1" max="365">
                    </label>
                    <p class="setting-description">API keys expire after this many days</p>
                </div>

                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="api_require_auth" checked>
                        <span>Require authentication for all API endpoints</span>
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">CORS Allowed Origins (comma-separated)</span>
                        <input type="text" id="cors_origins" class="form-control" placeholder="https://example.com, https://app.example.com">
                    </label>
                    <p class="setting-description">Leave blank to disable CORS (local only)</p>
                </div>
            </section>

            <!-- Webhooks -->
            <section id="webhooks" class="settings-section">
                <h2>ü™ù Webhook Settings</h2>
                
                <div class="setting-group">
                    <label class="setting-checkbox">
                        <input type="checkbox" id="webhooks_enabled">
                        <span>Enable webhooks</span>
                    </label>
                    <p class="setting-description">Allow system to send webhook notifications</p>
                </div>

                <div class="setting-group">
                    <h3>System Event Webhooks</h3>
                    <label class="setting-label">
                        <span class="label-text">System Errors URL</span>
                        <input type="text" id="webhook_system_errors" class="form-control" placeholder="https://hooks.example.com/errors">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Admin Actions URL</span>
                        <input type="text" id="webhook_admin_actions" class="form-control" placeholder="https://hooks.example.com/admin">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Data Changes URL</span>
                        <input type="text" id="webhook_data_changes" class="form-control" placeholder="https://hooks.example.com/data">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Webhook Retry Attempts</span>
                        <input type="number" id="webhook_retry_attempts" class="form-control" value="3" min="0" max="10">
                    </label>
                </div>

                <div class="setting-group">
                    <label class="setting-label">
                        <span class="label-text">Webhook Timeout (seconds)</span>
                        <input type="number" id="webhook_timeout" class="form-control" value="30" min="5" max="300">
                    </label>
                </div>
            </section>

            <!-- Action Bar -->
            <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveAdminSettings()">
                    <span class="icon">üíæ</span> Save All Settings
                </button>
                <button class="btn btn-secondary" onclick="discardAdminChanges()">
                    <span class="icon">‚Ü©Ô∏è</span> Discard Changes
                </button>
                <button class="btn btn-danger" onclick="resetAdminDefaults()">
                    <span class="icon">‚ö†Ô∏è</span> Reset to Defaults
                </button>
                <span id="unsaved-indicator" class="unsaved-indicator" style="display: none;">
                    ‚ö†Ô∏è Unsaved changes
                </span>
            </div>
        </main>
    </div>
</div>

<style>
/* Override any inherited styles to ensure readability */
.admin-settings-container * {
    box-sizing: border-box;
}

.admin-settings-container label,
.admin-settings-container span,
.admin-settings-container p {
    color: inherit;
}

.admin-settings-container {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
    color: #ffffff;
}

.settings-header {
    margin-bottom: 30px;
    border-bottom: 2px solid #4CAF50;
    padding-bottom: 15px;
}

.settings-header h1 {
    margin: 0 0 10px 0;
    color: #ffffff;
    font-size: 32px;
}

.settings-header .subtitle {
    margin: 0;
    color: #9e9e9e;
    font-size: 16px;
}

.settings-layout {
    display: flex;
    gap: 30px;
    min-height: 600px;
}

.settings-sidebar {
    width: 280px;
    flex-shrink: 0;
}

.settings-nav {
    position: sticky;
    top: 20px;
}

.nav-section {
    margin-bottom: 25px;
}

.nav-section h3 {
    font-size: 12px;
    text-transform: uppercase;
    color: #9e9e9e;
    margin: 0 0 10px 15px;
    letter-spacing: 1px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    color: #ffffff;
    text-decoration: none;
    border-radius: 8px;
    margin-bottom: 5px;
    transition: all 0.2s;
    background: #1a1a1a;
    border: 1px solid transparent;
}

.nav-item:hover {
    background: #2a2a2a;
    border-color: #4CAF50;
}

.nav-item.active {
    background: #4CAF50;
    color: #000000;
    font-weight: 600;
}

.nav-item .icon {
    font-size: 20px;
}

.settings-content {
    flex: 1;
    min-width: 0;
}

.settings-section {
    display: none;
    background: #252525;
    border-radius: 12px;
    padding: 30px;
}

.settings-section.active {
    display: block;
}

.settings-section h2 {
    margin: 0 0 25px 0;
    color: #4CAF50;
    font-size: 28px;
    border-bottom: 2px solid #333;
    padding-bottom: 15px;
}

.settings-section h3 {
    margin: 25px 0 15px 0;
    color: #ffffff;
    font-size: 18px;
}

.setting-group {
    margin-bottom: 25px;
}

.setting-label {
    display: block;
    margin-bottom: 8px;
}

.label-text {
    display: block;
    color: #ffffff;
    font-weight: 500;
    margin-bottom: 8px;
}

.setting-description {
    margin: 5px 0 0 0;
    color: #9e9e9e;
    font-size: 14px;
}

.form-control {
    width: 100%;
    max-width: 500px;
    padding: 10px 15px;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 6px;
    color: #ffffff;
    font-size: 14px;
}

.form-control:focus {
    outline: none;
    border-color: #4CAF50;
}

.form-control option {
    background: #1a1a1a;
    color: #ffffff;
}

textarea.form-control {
    resize: vertical;
    font-family: inherit;
    line-height: 1.5;
}

.setting-checkbox {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    color: #ffffff;
}

.setting-checkbox span {
    color: #ffffff;
    font-size: 14px;
}

.setting-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: #4CAF50;
}

.permission-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.permission-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: #1a1a1a;
    border-radius: 6px;
    cursor: pointer;
    border: 1px solid transparent;
    color: #ffffff;
}

.permission-item:hover {
    border-color: #4CAF50;
}

.permission-item span {
    color: #ffffff;
    font-size: 14px;
}

.permission-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #4CAF50;
}

.settings-actions {
    position: sticky;
    bottom: 0;
    background: #1a1a1a;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    display: flex;
    gap: 15px;
    align-items: center;
    border: 2px solid #333;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    text-decoration: none;
}

.btn .icon {
    font-size: 16px;
}

.btn-primary {
    background: #4CAF50;
    color: #000000;
}

.btn-primary:hover {
    background: #45a049;
    color: #000000;
}

.btn-secondary {
    background: #666;
    color: #ffffff;
}

.btn-secondary:hover {
    background: #777;
    color: #ffffff;
}

.btn-danger {
    background: #f44336;
    color: #ffffff;
}

.btn-danger:hover {
    background: #da190b;
    color: #ffffff;
}

.unsaved-indicator {
    margin-left: auto;
    color: #ff9800;
    font-weight: 600;
    padding: 8px 16px;
    background: rgba(255, 152, 0, 0.1);
    border-radius: 6px;
    border: 1px solid #ff9800;
}
</style>

<script src="/static/js/admin-settings.js"></script>
{% endblock %}
